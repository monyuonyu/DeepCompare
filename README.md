# DeepCompare

DeepCompare は、Python で実装されたコード差分比較ツールです。
軽量な MiniLM モデル（[sentence-transformers/paraphrase-MiniLM-L6-v2](https://huggingface.co/sentence-transformers/paraphrase-MiniLM-L6-v2)）を利用して、2 つのソースコードファイルの各行の意味的類似度を計算し、動的計画法による最適な行アライメントを行います。
GUI 部分は PyQt6 を使用しており、ダークテーマに対応したフレームレスウィンドウ、カスタムタイトルバー、ドラッグ＆ドロップによるファイル選択、ウィンドウリサイズ機能などを備えています。

## 特徴

DeepCompare は、従来の単純なテキスト比較ツールとは異なり、**AI ベースの推論を用いた高度なコード比較**を行います。MiniLM による文脈理解を活用し、単なる文字の差異ではなく、意味的な類似性を高精度に評価できます。


- **行単位比較**  
  各ファイルを行ごとに分割し、MiniLM により行の埋め込みを取得して、コサイン類似度を計算します。

- **最適アライメント**  
  Needleman–Wunsch アルゴリズムを用いて、2 つのファイルの行を最適にアライメントし、差分を表示します。

- **文字レベルの差分ハイライト**  
  差分がある行について、行全体の背景色をダークテーマに合わせた青みのある色で表示し、行内の差分部分はオレンジ色のフォントでハイライトします。

- **GUI 機能**  
  - PyQt6 によるダークテーマ対応のフレームレスウィンドウ
  - カスタムタイトルバー（最小化／最大化／閉じるボタン、ダブルクリックで最大化／元に戻し）
  - ドラッグ＆ドロップ対応のファイル入力欄
  - リサイズ可能なウィンドウ（マウス操作でリサイズ可能）

## 必要な環境・依存ライブラリ

- Python 3.7 以降
- [PyTorch](https://pytorch.org/)
- [sentence-transformers](https://www.sbert.net/)
- [PyQt6](https://pypi.org/project/PyQt6/)

### インストール方法

1. リポジトリをクローンまたはダウンロードします。
2. 仮想環境を作成（任意）。

   ```bash
   python -m venv .venv
   ```

3. 仮想環境を有効化します。

   - Windows:

     ```bash
     .venv\Scripts\activate
     ```

   - macOS/Linux:

     ```bash
     source .venv/bin/activate
     ```

4. 依存ライブラリをインストールします。

   ```bash
   pip install -r requirements.txt
   ```

## 使い方

1. `DeepCompare.py` を実行します。

   ```bash
   python DeepCompare.py
   ```

2. 起動時に「MINI LM 読み込み中...」と表示され、モデルの読み込みが完了するとメインウィンドウが表示されます。
3. ファイル選択欄から 2 つの比較対象ファイル（例: Python コード）を入力またはドラッグ＆ドロップで選択します。
4. 「比較開始」ボタンをクリックすると、2 つのファイルが行単位で比較され、以下の順番でテーブルに結果が表示されます。

   - **File1 行番号**  
   - **File1**（内容）  
   - **File2 行番号**  
   - **File2**（内容）  
   - **Score**（各行の類似度スコア）

   差分がある行は、行全体の背景が青みがかった色に変わり、行内の差分部分はオレンジ色のフォントでハイライトされます。

## プロジェクト構成

```
DeepCompare/
├── DeepCompare.py         # メインプログラム（GUI 版）
├── README.md              # このドキュメント
└── requirements.txt       # 依存ライブラリ一覧
```

## 既存ツールとの違い

DeepCompare は、単なるテキスト比較ではなく、**AI による意味的な解析**を用いてコードの変更点を見極めるツールです。従来のコンペアツールが文字の差分をそのまま表示するのに対し、DeepCompare は「どこが本質的に変わったのか」を精度高く捉えます。

特に、コードのリファクタリングやスタイル変更など、処理内容がほぼ同じである場合には差分を抑制し、本質的なロジック変更やバグ修正部分を強調表示してくれるため、**開発者が本当に知りたい差分だけに集中できる**のが大きな魅力です。

さらに、AI を活用することで、今後より幅広いプログラミング言語や記法の違いにも対応しやすく、チーム内でのレビュー効率向上や誤検出の削減に寄与します。文字列の変更を追うだけの既存ツールと比較して、**DeepCompare は意味を理解するコード差分ツール**として、モダンな開発現場で活躍します。
