# DeepCompare

DeepCompare は、Python で実装されたコード差分比較ツールです。軽量な MiniLM モデル（[sentence-transformers/paraphrase-MiniLM-L6-v2](https://huggingface.co/sentence-transformers/paraphrase-MiniLM-L6-v2)）を利用して、2 つのソースコードファイルの各行の意味的類似度を計算し、動的計画法による最適な行アライメントを行います。GUI 部分は PyQt6 を使用しており、ダークテーマに対応したフレームレスウィンドウ、カスタムタイトルバー、ドラッグ＆ドロップによるファイル選択、ウィンドウリサイズ機能などを備えています。

---

## 特徴

DeepCompare は、従来の単純なテキスト比較ツールとは異なり、**AI ベースの推論を用いた高度なコード比較**を行います。MiniLM による文脈理解を活用し、単なる文字の差異ではなく、意味的な類似性を高精度に評価できます。

- **行単位比較**  
  各ファイルを行ごとに分割し、MiniLM により行の埋め込みを取得してコサイン類似度を算出。文字ベースの差分だけでなく、本質的に似た行を見つけられます。

- **最適アライメント**  
  Needleman–Wunsch アルゴリズムを用いて、2 つのファイル間の行を最適に対応付け。不要な差分が減り、変更点が明確になります。

- **文字レベルの差分ハイライト**  
  差分がある行は、行全体をダークテーマに合う色で背景ハイライトし、行内の差分部分はオレンジ色のフォントで表示します。

- **GUI 機能**  
  - ダークテーマ対応のフレームレスウィンドウ  
  - カスタムタイトルバー（最小化／最大化／閉じるボタン、ダブルクリックで最大化／元に戻し）  
  - ドラッグ＆ドロップ対応のファイル入力欄  
  - マウス操作によるリサイズ

---

## 必要な環境・依存ライブラリ

- Python 3.7 以降
- [PyTorch](https://pytorch.org/)
- [sentence-transformers](https://www.sbert.net/)
- [PyQt6](https://pypi.org/project/PyQt6/)

### インストール方法

1. リポジトリをクローンまたはダウンロードします。
2. 仮想環境を作成（任意）。

   ```bash
   python -m venv .venv
   ```
3. 仮想環境を有効化します。

   - Windows:

     ```bash
     .venv\Scripts\activate
     ```
   - macOS/Linux:

     ```bash
     source .venv/bin/activate
     ```
4. 依存ライブラリをインストールします。

   ```bash
   pip install -r requirements.txt
   ```

---

## 使い方

1. `DeepCompare.py` を実行します。

   ```bash
   python DeepCompare.py
   ```
2. 起動時に「MINI LM 読み込み中...」と表示され、モデル読み込み後にメインウィンドウが起動します。
3. ファイル入力欄に 2 つのコードファイルを指定（またはドラッグ＆ドロップ）します。
4. 「比較開始」ボタンをクリックすると行単位で類似度を評価し、以下の順で結果がテーブルに表示されます。

   - **File1 行番号**  
   - **File1（内容）**  
   - **File2 行番号**  
   - **File2（内容）**  
   - **Score（類似度スコア）**

行全体がハイライトされた差分行については、行内での文字レベル変更をオレンジ色で強調表示します。

---

## プロジェクト構成

```
DeepCompare/
├── DeepCompare.py         # メインプログラム（GUI 版）
├── README.md              # このドキュメント
└── requirements.txt       # 依存ライブラリ一覧
```

---

## 既存ツールとの違い

DeepCompare は、WinMerge や Beyond Compare などの文字ベースのコンペアツールとは異なり、**AI による意味的な解析**を駆使してコードの変更点を見極めます。行単位の比較であっても、本質的な変更だけを精度高く捉えられるため、コードのリファクタリングやスタイル変更を行っただけの場合の不要な差分が大幅に軽減されます。

特に、既存ツールに比べて「どこが本質的に変わったのか」を強調できるため、開発者が追うべき差分を見逃しにくく、レビューの効率を向上させます。
